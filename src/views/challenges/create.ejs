<div class="min-h-screen bg-slate-50">
	<!-- Header -->
	<header class="bg-white border-b border-slate-200">
		<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
			<a href="/teams/<%= team.id %>/challenges" class="text-teal-600 hover:underline text-sm mb-2 inline-block">
				‚Üê Back to Challenges
			</a>
			<h1 class="text-3xl font-bold text-slate-900">Create Challenge</h1>
			<p class="text-slate-600 mt-2">Create a new challenge for <%= team.name %></p>
		</div>
	</header>

	<!-- Main Content -->
	<main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
		<form id="createChallengeForm" action="/teams/<%= team.id %>/challenges" method="POST"
			  class="bg-white rounded-lg border border-slate-200 p-6">

			<!-- Challenge Name -->
			<div class="mb-6">
				<label for="name" class="block text-sm font-medium text-slate-700 mb-2">
					Challenge Name <span class="text-red-500">*</span>
				</label>
				<input
					type="text"
					id="name"
					name="name"
					required
					maxlength="100"
					placeholder="e.g., Summer Transformation Challenge"
					class="w-full px-4 py-3 bg-white text-slate-900 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
				>
			</div>

			<!-- Description -->
			<div class="mb-6">
				<label for="description" class="block text-sm font-medium text-slate-700 mb-2">
					Description <span class="text-red-500">*</span>
				</label>
				<textarea
					id="description"
					name="description"
					required
					rows="4"
					maxlength="1000"
					placeholder="Describe the challenge goals, rules, and any special instructions..."
					class="w-full px-4 py-3 bg-white text-slate-900 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent resize-none"
				></textarea>
				<p class="mt-1 text-xs text-slate-500">Maximum 1000 characters</p>
			</div>

			<!-- Challenge Type -->
			<div class="mb-6">
				<label for="type" class="block text-sm font-medium text-slate-700 mb-2">
					Challenge Type <span class="text-red-500">*</span>
				</label>
				<select
					id="type"
					name="type"
					required
					class="w-full px-4 py-3 bg-white text-slate-900 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
				>
					<option value="">Select challenge type...</option>
					<option value="WEIGHT_LOSS_PERCENTAGE">Weight Loss Percentage - Track % of starting weight lost</option>
					<option value="TOTAL_WEIGHT_LOSS">Total Weight Loss - Track absolute weight lost (lbs/kg)</option>
					<option value="CONSISTENCY">Consistency - Track number of weight log entries</option>
					<option value="ACTIVITY_BASED">Activity Based - Track activity goals (coming soon)</option>
				</select>
			</div>

			<!-- Date Range -->
			<div class="grid md:grid-cols-2 gap-6 mb-6">
				<div>
					<label for="startDate" class="block text-sm font-medium text-slate-700 mb-2">
						Start Date <span class="text-red-500">*</span>
					</label>
					<input
						type="date"
						id="startDate"
						name="startDate"
						required
						class="w-full px-4 py-3 bg-white text-slate-900 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
					>
				</div>
				<div>
					<label for="endDate" class="block text-sm font-medium text-slate-700 mb-2">
						End Date <span class="text-red-500">*</span>
					</label>
					<input
						type="date"
						id="endDate"
						name="endDate"
						required
						class="w-full px-4 py-3 bg-white text-slate-900 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
					>
				</div>
			</div>

			<!-- Optional Settings -->
			<div class="border-t border-slate-200 pt-6 mb-6">
				<h3 class="text-lg font-semibold text-slate-900 mb-4">Optional Settings</h3>

				<div class="grid md:grid-cols-2 gap-6">
					<!-- Target Value -->
					<div>
						<label for="targetValue" class="block text-sm font-medium text-slate-700 mb-2">
							Target Value
						</label>
						<input
							type="number"
							id="targetValue"
							name="targetValue"
							step="0.1"
							min="0"
							placeholder="e.g., 10"
							class="w-full px-4 py-3 bg-white text-slate-900 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
						>
						<p class="mt-1 text-xs text-slate-500" id="targetValueHelp">
							Optional goal to reach (%, lbs, or days depending on type)
						</p>
					</div>

					<!-- Reward Points -->
					<div>
						<label for="rewardPoints" class="block text-sm font-medium text-slate-700 mb-2">
							Reward Points
						</label>
						<input
							type="number"
							id="rewardPoints"
							name="rewardPoints"
							min="0"
							placeholder="e.g., 100"
							class="w-full px-4 py-3 bg-white text-slate-900 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
						>
						<p class="mt-1 text-xs text-slate-500">Points awarded for completing the challenge</p>
					</div>
				</div>
			</div>

			<!-- Error Display -->
			<div id="errorDisplay" class="hidden mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
				<p class="text-red-800 text-sm"></p>
			</div>

			<!-- Actions -->
			<div class="flex items-center justify-end gap-4">
				<a href="/teams/<%= team.id %>/challenges"
				   class="px-6 py-3 text-slate-700 hover:bg-slate-100 rounded-lg transition-colors">
					Cancel
				</a>
				<button
					type="submit"
					class="px-6 py-3 bg-teal-600 hover:bg-teal-700 text-white font-medium rounded-lg transition-colors"
				>
					Create Challenge
				</button>
			</div>
		</form>
	</main>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
	const form = document.getElementById('createChallengeForm');
	const typeSelect = document.getElementById('type');
	const targetValueHelp = document.getElementById('targetValueHelp');
	const errorDisplay = document.getElementById('errorDisplay');
	const startDateInput = document.getElementById('startDate');
	const endDateInput = document.getElementById('endDate');

	// Set minimum date to today
	const today = new Date().toISOString().split('T')[0];
	startDateInput.setAttribute('min', today);

	// Update end date minimum when start date changes
	startDateInput.addEventListener('change', function() {
		endDateInput.setAttribute('min', this.value);
		if (endDateInput.value && endDateInput.value <= this.value) {
			endDateInput.value = '';
		}
	});

	// Update target value help text based on challenge type
	typeSelect.addEventListener('change', function() {
		switch(this.value) {
			case 'WEIGHT_LOSS_PERCENTAGE':
				targetValueHelp.textContent = 'Target percentage of weight to lose (e.g., 5 for 5%)';
				break;
			case 'TOTAL_WEIGHT_LOSS':
				targetValueHelp.textContent = 'Target weight to lose in lbs or kg (e.g., 10)';
				break;
			case 'CONSISTENCY':
				targetValueHelp.textContent = 'Target number of days to log weight (e.g., 30)';
				break;
			case 'ACTIVITY_BASED':
				targetValueHelp.textContent = 'Activity goal (feature coming soon)';
				break;
			default:
				targetValueHelp.textContent = 'Optional goal to reach (%, lbs, or days depending on type)';
		}
	});

	// Form submission
	form.addEventListener('submit', async function(e) {
		e.preventDefault();
		errorDisplay.classList.add('hidden');

		const formData = new FormData(form);
		const data = Object.fromEntries(formData.entries());

		try {
			const response = await fetch(form.action, {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify(data),
			});

			if (response.redirected) {
				window.location.href = response.url;
				return;
			}

			const result = await response.json();

			if (!result.success) {
				const errors = result.errors || [{ msg: result.message }];
				const errorMessages = errors.map(err => err.msg).join(', ');
				errorDisplay.querySelector('p').textContent = errorMessages;
				errorDisplay.classList.remove('hidden');
			}
		} catch (error) {
			errorDisplay.querySelector('p').textContent = 'An error occurred. Please try again.';
			errorDisplay.classList.remove('hidden');
		}
	});
});
</script>
