<div class="bg-white rounded-xl shadow-sm p-6 border border-slate-200 hover:shadow-md transition-shadow">
	<!-- Post Header -->
	<div class="flex items-start gap-4 mb-4">
		<!-- Author Avatar -->
		<% if (post.author.avatarUrl) { %>
			<img src="<%= post.author.avatarUrl %>" alt="<%= post.author.displayName || post.author.username %>" class="w-12 h-12 rounded-full">
		<% } else { %>
			<div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
				<span class="text-lg font-bold text-teal-600">
					<%= (post.author.displayName || post.author.username).charAt(0).toUpperCase() %>
				</span>
			</div>
		<% } %>

		<!-- Author Info -->
		<div class="flex-1 min-w-0">
			<div class="flex items-start justify-between">
				<div>
					<p class="font-semibold text-slate-900">
						<%= post.author.displayName || post.author.username %>
					</p>
					<div class="flex items-center gap-2 text-sm text-slate-500">
						<span><%= new Date(post.createdAt).toLocaleDateString() %></span>
						<span>â€¢</span>
						<% if (post.type !== 'GENERAL') { %>
							<span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 capitalize">
								<%= post.type.toLowerCase().replace('_', ' ') %>
							</span>
						<% } %>
					</div>
				</div>

				<!-- Post Actions Menu (if author or admin) -->
				<% if (typeof user !== 'undefined' && user && (user.id === post.authorId || userRole === 'ADMIN' || userRole === 'OWNER')) { %>
					<div class="relative" x-data="{ open: false }">
						<button @click="open = !open" @click.away="open = false" class="text-slate-400 hover:text-slate-600 p-1">
							<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
								<path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"></path>
							</svg>
						</button>
						<div x-show="open" x-cloak class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-1 z-10 border border-slate-200">
							<% if (user.id === post.authorId) { %>
								<a href="/posts/<%= post.id %>/edit" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">
									Edit Post
								</a>
							<% } %>
							<button onclick="deletePost('<%= post.id %>')" class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-slate-100">
								Delete Post
							</button>
						</div>
					</div>
				<% } %>
			</div>
		</div>
	</div>

	<!-- Post Content -->
	<a href="/posts/<%= post.id %>" class="block group">
		<% if (post.title) { %>
			<h3 class="text-xl font-bold text-slate-900 mb-2 group-hover:text-teal-600 transition-colors">
				<%= post.title %>
			</h3>
		<% } %>
		<div class="text-slate-700 prose max-w-none">
			<%= post.content.length > 500 ? post.content.substring(0, 500) + '...' : post.content %>
		</div>
		<% if (post.content.length > 500) { %>
			<p class="text-teal-600 text-sm mt-2 font-medium group-hover:underline">
				Read more
			</p>
		<% } %>
	</a>

	<!-- Tags -->
	<% if (post.tags && post.tags.length > 0) { %>
		<div class="flex flex-wrap gap-2 mt-3">
			<% post.tags.forEach(function(tag) { %>
				<span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-slate-100 text-slate-700">
					#<%= tag %>
				</span>
			<% }); %>
		</div>
	<% } %>

	<!-- Post Stats & Actions -->
	<div class="flex items-center gap-6 mt-4 pt-4 border-t border-slate-200">
		<!-- Like Button -->
		<button
			onclick="toggleLike('<%= post.id %>', this)"
			data-liked="<%= post.isLiked %>"
			class="flex items-center gap-2 text-sm text-slate-600 hover:text-teal-600 transition-colors group">
			<svg class="w-5 h-5 <%= post.isLiked ? 'fill-current text-teal-600' : '' %> group-hover:scale-110 transition-transform" fill="<%= post.isLiked ? 'currentColor' : 'none' %>" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
			</svg>
			<span class="like-count"><%= post._count.likes %></span>
			<span><%= post._count.likes === 1 ? 'Like' : 'Likes' %></span>
		</button>

		<!-- Comment Count -->
		<a href="/posts/<%= post.id %>#comments" class="flex items-center gap-2 text-sm text-slate-600 hover:text-teal-600 transition-colors">
			<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
			</svg>
			<span><%= post._count.comments %></span>
			<span><%= post._count.comments === 1 ? 'Comment' : 'Comments' %></span>
		</a>
	</div>
</div>

<script>
// Like/Unlike functionality
async function toggleLike(postId, button) {
	const wasLiked = button.dataset.liked === 'true';
	const likeCountSpan = button.querySelector('.like-count');
	const heartIcon = button.querySelector('svg');

	try {
		const response = await fetch(`/posts/${postId}/like`, {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json',
			},
		});

		const data = await response.json();

		if (data.success) {
			button.dataset.liked = data.data.liked;
			const currentCount = parseInt(likeCountSpan.textContent);
			likeCountSpan.textContent = data.data.liked ? currentCount + 1 : currentCount - 1;

			// Toggle heart fill
			if (data.data.liked) {
				heartIcon.setAttribute('fill', 'currentColor');
				heartIcon.classList.add('text-teal-600', '');
			} else {
				heartIcon.setAttribute('fill', 'none');
				heartIcon.classList.remove('text-teal-600', '');
			}
		}
	} catch (error) {
		console.error('Error toggling like:', error);
	}
}

// Delete post functionality
async function deletePost(postId) {
	if (!confirm('Are you sure you want to delete this post? This action cannot be undone.')) {
		return;
	}

	try {
		const response = await fetch(`/posts/${postId}`, {
			method: 'DELETE',
			headers: {
				'Content-Type': 'application/json',
			},
		});

		const data = await response.json();

		if (data.success) {
			window.location.reload();
		} else {
			alert(data.message || 'Failed to delete post');
		}
	} catch (error) {
		console.error('Error deleting post:', error);
		alert('An error occurred while deleting the post');
	}
}
</script>
